From 9fbdfb8472c465d28264135142fa7f9860464b12 Mon Sep 17 00:00:00 2001
From: Dmitry <iamdmitrymayorov@gmail.com>
Date: Wed, 10 May 2017 12:19:20 +0300
Subject: [PATCH] Add support for Jetpack Widgets

---
 assets/css/sass/abstracts/_mixins.scss         |  17 +++
 assets/css/sass/components/_accessibility.scss |  15 +--
 assets/css/sass/layout/_galleries.scss         |  16 ++-
 assets/css/sass/layout/_widgets.scss           | 140 +++++++++++++++++++--
 functions.php                                  |   2 +-
 style-rtl.css                                  | 167 +++++++++++++++++++++++--
 style.css                                      | 167 +++++++++++++++++++++++--
 7 files changed, 473 insertions(+), 51 deletions(-)

diff --git a/assets/css/sass/abstracts/_mixins.scss b/assets/css/sass/abstracts/_mixins.scss
index e36a51c..cca49d2 100755
--- a/assets/css/sass/abstracts/_mixins.scss
+++ b/assets/css/sass/abstracts/_mixins.scss
@@ -51,6 +51,23 @@
 	outline-offset: -2px;
 }
 
+@mixin screen-reader-text() {
+	overflow: hidden;
+	clip: rect(1px, 1px, 1px, 1px);
+	position: absolute !important;
+	width: 1px;
+	height: 1px;
+	&:hover,
+	&:active,
+	&:focus {
+		display: block;
+		clip: auto !important;
+		z-index: 100000; // Above WP toolbar.
+		width: auto;
+		height: auto;
+	}
+}
+
 // Using a mixin here to reuse it for editor CSS file. Since some of the
 // properties are getting overriden there.
 @mixin counter-playlist {
diff --git a/assets/css/sass/components/_accessibility.scss b/assets/css/sass/components/_accessibility.scss
index f8c1bcc..52b15f0 100755
--- a/assets/css/sass/components/_accessibility.scss
+++ b/assets/css/sass/components/_accessibility.scss
@@ -1,18 +1,5 @@
 /* Accessibility */
 
 .screen-reader-text {
-	overflow: hidden;
-	clip: rect(1px, 1px, 1px, 1px);
-	position: absolute !important;
-	width: 1px;
-	height: 1px;
-	&:hover,
-	&:active,
-	&:focus {
-		display: block;
-		clip: auto !important;
-		z-index: 100000; // Above WP toolbar.
-		width: auto;
-		height: auto;
-	}
+	@include screen-reader-text;
 }
diff --git a/assets/css/sass/layout/_galleries.scss b/assets/css/sass/layout/_galleries.scss
index 325387e..5c719e6 100755
--- a/assets/css/sass/layout/_galleries.scss
+++ b/assets/css/sass/layout/_galleries.scss
@@ -6,11 +6,16 @@
 
 .gallery,
 #content .tiled-gallery {
-	margin: 0 -2px 27px;
-	margin: 0 -2px 1.5rem;
+	margin: 0 -2px 1.5em;
 	@media screen and ( min-width: $sm ) {
-		margin: 40.5px -2px 40.5px;
-		margin: 2.25rem -2px 2.25rem;
+		margin: 0.5em -2px 2.25em;
+	}
+}
+
+* + .gallery,
+#content * + .tiled-gallery {
+	@media screen and ( min-width: $sm ) {
+		margin-top: 2.25em;
 	}
 }
 
@@ -35,6 +40,9 @@
 		}
 	}
 }
+.tiled-gallery .tiled-gallery-item a {
+	display: block;
+}
 
 .gallery-caption {
 	display: block;
diff --git a/assets/css/sass/layout/_widgets.scss b/assets/css/sass/layout/_widgets.scss
index 6cb9645..16fbdde 100644
--- a/assets/css/sass/layout/_widgets.scss
+++ b/assets/css/sass/layout/_widgets.scss
@@ -30,10 +30,15 @@
 			list-style: none;
 		}
 	}
+	p:last-child,
+	p:only-child {
+		margin-bottom: 0;
+	}
 }
 
-.widget.widget_text.textwidget p:last-child {
-	margin-bottom: 0;
+.widget-title {
+	margin-top: 0;
+	margin-bottom: 0.75em;
 }
 
 .widget.widget_search {
@@ -85,12 +90,8 @@
 .widget.widget_rss {
 	li {
 		margin-bottom: 0.75em;
-		padding-bottom: 0.75em;
-		border-bottom: 1px solid;
-		border-bottom-color: $color__gray;
 		&:last-child {
 			margin-bottom: 0;
-			border-bottom: none;
 		}
 	}
 }
@@ -124,7 +125,7 @@
 	ul ul {
 		margin-left: 1em;
 	}
-	[class^="menu-inline-"] {
+	[class^='menu-inline-'] {
 		ul ul {
 			display: inline;
 			margin-left: 0;
@@ -136,7 +137,126 @@
 	}
 }
 
-.widget-title {
-	margin-top: 0;
-	margin-bottom: 0.75em;
+// Image.
+.widget.widget_image {
+	a {
+		display: block;
+	}
+	img,
+	.wp-caption {
+		display: block;
+		margin: 0 0 !important;
+	}
+	figcaption {
+		margin-top: 0.25em;
+	}
+}
+
+// Contact Info.
+.widget.widget_contact_info {
+	iframe,
+	> div {
+		margin-bottom: 0.75em;
+	}
+	> div:last-child {
+		margin-bottom: 0;
+	}
+}
+
+.widget.widget_authors {
+	.widget-title {
+		margin-bottom: 1.5em;
+	}
+	> ul {
+		> li {
+			margin-bottom: 1.5em;
+			&:last-child {
+				margin: 0;
+			}
+			> a {
+				display: block;
+				margin-bottom: 0.75em;
+			}
+			img {
+				border-radius: 50%;
+			}
+			li {
+				margin-bottom: 0.75em;
+			}
+		}
+	}
+}
+
+// Facebook, Twitter and Google +.
+.widget {
+	&.widget_facebook_likebox,
+ 	&.widget_googleplus_badge {
+		padding: 0;
+		border: none;
+		background-color: transparent;
+		.widget-title {
+			@include screen-reader-text;
+		}
+	}
+}
+
+// Jetpack Display Posts.
+.widget .jetpack-display-remote-posts {
+	margin: 0;
+	h4 {
+		font-size: inherit;
+		margin-bottom: 0.75rem;
+		line-height: 1.5;
+	}
+	> a {
+		display: block;
+		margin-bottom: 0.5rem;
+	}
+}
+
+// Flickr.
+// Waiting on https://github.com/Automattic/jetpack/issues/7089
+
+// Gallery.
+#content .widget .tiled-gallery {
+	margin-bottom: 0;
+}
+
+// Gravatar.
+.widget.widget-grofile {
+	h4 {
+		font-size: 1rem;
+		font-weight: 700;
+	}
+	.grofile-accounts {
+		margin-bottom: 1em;
+	}
+}
+
+// Internet Defense Badge.
+.widget.widget_internet_defense_league_widget {
+	a, img {
+		display: block;
+		margin: 0 auto;
+	}
+}
+
+// Milestone.
+.widget.milestone-widget {
+	margin: 0 0 2.5em;
+	@media screen and ( min-width: $sm ) {
+		margin: 0 0 3em;
+	}
+}
+
+// Twitter.
+// Facebook, Twitter and Google +.
+.widget {
+	&.widget_twitter_timeline {
+		padding: 0;
+		// border: none;
+		.widget-title {
+			@include screen-reader-text;
+		}
+	}
 }
diff --git a/functions.php b/functions.php
index 3ed5514..5a15510 100755
--- a/functions.php
+++ b/functions.php
@@ -449,7 +449,7 @@ function counter_scripts() {
 
 	wp_localize_script( 'counter-navigation', 'counterScreenReaderText', array(
 		'menu' => esc_html__( 'Menu', 'counter' ),
-		'close' => esc_html__( 'Close', 'counter' ),	
+		'close' => esc_html__( 'Close', 'counter' ),
 		'expand' => '<span class="screen-reader-text">' . esc_html__( 'Expand child menu', 'counter' ) . '</span>',
 		'collapse' => '<span class="screen-reader-text">' . esc_html__( 'Collapse child menu', 'counter' ) . '</span>',
 	) );
diff --git a/style-rtl.css b/style-rtl.css
index 3251908..1533016 100644
--- a/style-rtl.css
+++ b/style-rtl.css
@@ -1981,8 +1981,7 @@ body {
 
 .gallery,
 #content .tiled-gallery {
-	margin: 0 -2px 27px;
-	margin: 0 -2px 1.5rem;
+	margin: 0 -2px 1.5em;
 }
 
 .gallery {
@@ -2043,6 +2042,10 @@ body {
 	width: 10%;
 }
 
+.tiled-gallery .tiled-gallery-item a {
+	display: block;
+}
+
 .gallery-caption {
 	display: block;
 	margin: 0.5em 0;
@@ -2102,10 +2105,16 @@ body {
 	list-style: none;
 }
 
-.widget.widget_text.textwidget p:last-child {
+.widget p:last-child,
+.widget p:only-child {
 	margin-bottom: 0;
 }
 
+.widget-title {
+	margin-top: 0;
+	margin-bottom: 0.75em;
+}
+
 .widget.widget_search {
 	padding: 0;
 	border: none;
@@ -2162,16 +2171,12 @@ body {
 .widget.widget_recent_entries li,
 .widget.widget_rss li {
 	margin-bottom: 0.75em;
-	padding-bottom: 0.75em;
-	border-bottom: 1px solid;
-	border-bottom-color: #e6e6e6;
 }
 
 .widget.widget_recent_comments li:last-child,
 .widget.widget_recent_entries li:last-child,
 .widget.widget_rss li:last-child {
 	margin-bottom: 0;
-	border-bottom: none;
 }
 
 .widget_rss .widget-title a:first-child {
@@ -2215,11 +2220,143 @@ body {
 	margin: 0 0.4em;
 }
 
-.widget-title {
-	margin-top: 0;
+.widget.widget_image a {
+	display: block;
+}
+
+.widget.widget_image img,
+.widget.widget_image .wp-caption {
+	display: block;
+	margin: 0 0 !important;
+}
+
+.widget.widget_image figcaption {
+	margin-top: 0.25em;
+}
+
+.widget.widget_contact_info iframe,
+.widget.widget_contact_info > div {
 	margin-bottom: 0.75em;
 }
 
+.widget.widget_contact_info > div:last-child {
+	margin-bottom: 0;
+}
+
+.widget.widget_authors .widget-title {
+	margin-bottom: 1.5em;
+}
+
+.widget.widget_authors > ul > li {
+	margin-bottom: 1.5em;
+}
+
+.widget.widget_authors > ul > li:last-child {
+	margin: 0;
+}
+
+.widget.widget_authors > ul > li > a {
+	display: block;
+	margin-bottom: 0.75em;
+}
+
+.widget.widget_authors > ul > li img {
+	border-radius: 50%;
+}
+
+.widget.widget_authors > ul > li li {
+	margin-bottom: 0.75em;
+}
+
+.widget.widget_facebook_likebox,
+.widget.widget_googleplus_badge {
+	padding: 0;
+	border: none;
+	background-color: transparent;
+}
+
+.widget.widget_facebook_likebox .widget-title,
+.widget.widget_googleplus_badge .widget-title {
+	overflow: hidden;
+	clip: rect(1px, 1px, 1px, 1px);
+	position: absolute !important;
+	width: 1px;
+	height: 1px;
+}
+
+.widget.widget_facebook_likebox .widget-title:hover,
+.widget.widget_facebook_likebox .widget-title:active,
+.widget.widget_facebook_likebox .widget-title:focus,
+.widget.widget_googleplus_badge .widget-title:hover,
+.widget.widget_googleplus_badge .widget-title:active,
+.widget.widget_googleplus_badge .widget-title:focus {
+	display: block;
+	clip: auto !important;
+	z-index: 100000;
+	width: auto;
+	height: auto;
+}
+
+.widget .jetpack-display-remote-posts {
+	margin: 0;
+}
+
+.widget .jetpack-display-remote-posts h4 {
+	margin-bottom: 0.75rem;
+	font-size: inherit;
+	line-height: 1.5;
+}
+
+.widget .jetpack-display-remote-posts > a {
+	display: block;
+	margin-bottom: 0.5rem;
+}
+
+#content .widget .tiled-gallery {
+	margin-bottom: 0;
+}
+
+.widget.widget-grofile h4 {
+	font-size: 1rem;
+	font-weight: 700;
+}
+
+.widget.widget-grofile .grofile-accounts {
+	margin-bottom: 1em;
+}
+
+.widget.widget_internet_defense_league_widget a,
+.widget.widget_internet_defense_league_widget img {
+	display: block;
+	margin: 0 auto;
+}
+
+.widget.milestone-widget {
+	margin: 0 0 2.5em;
+}
+
+.widget.widget_twitter_timeline {
+	padding: 0;
+}
+
+.widget.widget_twitter_timeline .widget-title {
+	overflow: hidden;
+	clip: rect(1px, 1px, 1px, 1px);
+	position: absolute !important;
+	width: 1px;
+	height: 1px;
+}
+
+.widget.widget_twitter_timeline .widget-title:hover,
+.widget.widget_twitter_timeline .widget-title:active,
+.widget.widget_twitter_timeline .widget-title:focus {
+	display: block;
+	clip: auto !important;
+	z-index: 100000;
+	width: auto;
+	height: auto;
+}
+
 /**
  * Widgets Footer
  */
@@ -2821,8 +2958,12 @@ body {
 
 	.gallery,
 	#content .tiled-gallery {
-		margin: 40.5px -2px 40.5px;
-		margin: 2.25rem -2px 2.25rem;
+		margin: 0.5em -2px 2.25em;
+	}
+
+	* + .gallery,
+	#content * + .tiled-gallery {
+		margin-top: 2.25em;
 	}
 
 	.post-navigation {
@@ -2921,6 +3062,10 @@ body {
 		margin: 0 0 3em;
 	}
 
+	.widget.milestone-widget {
+		margin: 0 0 3em;
+	}
+
 	.site-footer-widgets {
 		padding-top: 4.5em;
 		padding-bottom: 1.5em;
diff --git a/style.css b/style.css
index fa8f663..235183e 100644
--- a/style.css
+++ b/style.css
@@ -2013,8 +2013,7 @@ body {
 
 .gallery,
 #content .tiled-gallery {
-	margin: 0 -2px 27px;
-	margin: 0 -2px 1.5rem;
+	margin: 0 -2px 1.5em;
 }
 
 .gallery {
@@ -2075,6 +2074,10 @@ body {
 	width: 10%;
 }
 
+.tiled-gallery .tiled-gallery-item a {
+	display: block;
+}
+
 .gallery-caption {
 	display: block;
 	margin: 0.5em 0;
@@ -2134,10 +2137,16 @@ body {
 	list-style: none;
 }
 
-.widget.widget_text.textwidget p:last-child {
+.widget p:last-child,
+.widget p:only-child {
 	margin-bottom: 0;
 }
 
+.widget-title {
+	margin-top: 0;
+	margin-bottom: 0.75em;
+}
+
 .widget.widget_search {
 	padding: 0;
 	border: none;
@@ -2194,16 +2203,12 @@ body {
 .widget.widget_recent_entries li,
 .widget.widget_rss li {
 	margin-bottom: 0.75em;
-	padding-bottom: 0.75em;
-	border-bottom: 1px solid;
-	border-bottom-color: #e6e6e6;
 }
 
 .widget.widget_recent_comments li:last-child,
 .widget.widget_recent_entries li:last-child,
 .widget.widget_rss li:last-child {
 	margin-bottom: 0;
-	border-bottom: none;
 }
 
 .widget_rss .widget-title a:first-child {
@@ -2247,11 +2252,143 @@ body {
 	margin: 0 0.4em;
 }
 
-.widget-title {
-	margin-top: 0;
+.widget.widget_image a {
+	display: block;
+}
+
+.widget.widget_image img,
+.widget.widget_image .wp-caption {
+	display: block;
+	margin: 0 0 !important;
+}
+
+.widget.widget_image figcaption {
+	margin-top: 0.25em;
+}
+
+.widget.widget_contact_info iframe,
+.widget.widget_contact_info > div {
 	margin-bottom: 0.75em;
 }
 
+.widget.widget_contact_info > div:last-child {
+	margin-bottom: 0;
+}
+
+.widget.widget_authors .widget-title {
+	margin-bottom: 1.5em;
+}
+
+.widget.widget_authors > ul > li {
+	margin-bottom: 1.5em;
+}
+
+.widget.widget_authors > ul > li:last-child {
+	margin: 0;
+}
+
+.widget.widget_authors > ul > li > a {
+	display: block;
+	margin-bottom: 0.75em;
+}
+
+.widget.widget_authors > ul > li img {
+	border-radius: 50%;
+}
+
+.widget.widget_authors > ul > li li {
+	margin-bottom: 0.75em;
+}
+
+.widget.widget_facebook_likebox,
+.widget.widget_googleplus_badge {
+	padding: 0;
+	border: none;
+	background-color: transparent;
+}
+
+.widget.widget_facebook_likebox .widget-title,
+.widget.widget_googleplus_badge .widget-title {
+	overflow: hidden;
+	clip: rect(1px, 1px, 1px, 1px);
+	position: absolute !important;
+	width: 1px;
+	height: 1px;
+}
+
+.widget.widget_facebook_likebox .widget-title:hover,
+.widget.widget_facebook_likebox .widget-title:active,
+.widget.widget_facebook_likebox .widget-title:focus,
+.widget.widget_googleplus_badge .widget-title:hover,
+.widget.widget_googleplus_badge .widget-title:active,
+.widget.widget_googleplus_badge .widget-title:focus {
+	display: block;
+	clip: auto !important;
+	z-index: 100000;
+	width: auto;
+	height: auto;
+}
+
+.widget .jetpack-display-remote-posts {
+	margin: 0;
+}
+
+.widget .jetpack-display-remote-posts h4 {
+	margin-bottom: 0.75rem;
+	font-size: inherit;
+	line-height: 1.5;
+}
+
+.widget .jetpack-display-remote-posts > a {
+	display: block;
+	margin-bottom: 0.5rem;
+}
+
+#content .widget .tiled-gallery {
+	margin-bottom: 0;
+}
+
+.widget.widget-grofile h4 {
+	font-size: 1rem;
+	font-weight: 700;
+}
+
+.widget.widget-grofile .grofile-accounts {
+	margin-bottom: 1em;
+}
+
+.widget.widget_internet_defense_league_widget a,
+.widget.widget_internet_defense_league_widget img {
+	display: block;
+	margin: 0 auto;
+}
+
+.widget.milestone-widget {
+	margin: 0 0 2.5em;
+}
+
+.widget.widget_twitter_timeline {
+	padding: 0;
+}
+
+.widget.widget_twitter_timeline .widget-title {
+	overflow: hidden;
+	clip: rect(1px, 1px, 1px, 1px);
+	position: absolute !important;
+	width: 1px;
+	height: 1px;
+}
+
+.widget.widget_twitter_timeline .widget-title:hover,
+.widget.widget_twitter_timeline .widget-title:active,
+.widget.widget_twitter_timeline .widget-title:focus {
+	display: block;
+	clip: auto !important;
+	z-index: 100000;
+	width: auto;
+	height: auto;
+}
+
 /**
  * Widgets Footer
  */
@@ -2853,8 +2990,12 @@ body {
 
 	.gallery,
 	#content .tiled-gallery {
-		margin: 40.5px -2px 40.5px;
-		margin: 2.25rem -2px 2.25rem;
+		margin: 0.5em -2px 2.25em;
+	}
+
+	* + .gallery,
+	#content * + .tiled-gallery {
+		margin-top: 2.25em;
 	}
 
 	.post-navigation {
@@ -2970,6 +3111,10 @@ body {
 		margin: 0 0 3em;
 	}
 
+	.widget.milestone-widget {
+		margin: 0 0 3em;
+	}
+
 	.site-footer-widgets {
 		padding-top: 4.5em;
 		padding-bottom: 1.5em;
-- 
2.11.0 (Apple Git-81)

